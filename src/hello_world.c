#include <pebble.h>
#include "Glyph.h"

static Window *s_window;

static void layer_update_proc( Layer *layer, GContext *context ) {
	// Get the framebuffer
	GBitmap* frameBuffer = graphics_capture_frame_buffer( context );
	
	uint32_t fontData[128] = {
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000111010001100111,
		0b01011100110001011100000000000001,
		0b00011000010000100001000010000100,
		0b00000000000111010001000010001000,
		0b10001000111110000000000011101000,
		0b10000100110000011000101110000000,
		0b00000001000110010101001011111000,
		0b10000100000000000111111000011110,
		0b00001000011000101110000000000001,
		0b11010000111101000110001100010111,
		0b00000000000111110000100001000100,
		0b01000010000100000000000001110100,
		0b01100010111010001100010111000000,
		0b00000011101000110001100010111100,
		0b00101110000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000111010001100011111,
		0b11000110001100010000000000111101,
		0b00011000111110100011000111110000,
		0b00000000111010001100001000010000,
		0b10001011100000000000111101000110,
		0b00110001100011000111110000000000,
		0b01111110000100001111010000100001,
		0b11110000000000111111000010000111,
		0b10100001000010000000000000001110,
		0b10001100001001110001100010111000,
		0b00000000100011000110001111111000,
		0b11000110001000000000000100001000,
		0b01000010000100001000010000000000,
		0b00000010000100001000011000110001,
		0b01110000000000010001100101010011,
		0b00010100100101000100000000001000,
		0b01000010000100001000010000111110,
		0b00000000010001110111010110001100,
		0b01100011000100000000001000111001,
		0b10101100111000110001100010000000,
		0b00001110100011000110001100011000,
		0b10111000000000001111010001100011,
		0b11101000010000100000000000000011,
		0b10100011000110001100011000101110,
		0b00001000001111010001100011111010,
		0b00110001100010000000000011101000,
		0b11000001110000011000101110000000,
		0b00001111100100001000010000100001,
		0b00001000000000000100011000110001,
		0b10001100011000101110000000000010,
		0b00110001100010101001010001000010,
		0b00000000000100011000110001100011,
		0b01011101110001000000000010001010,
		0b10001000010000100010101000100000,
		0b00000100011000110001010100010000,
		0b10000100000000000011111000010001,
		0b00010001000100001111100000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000000000000,
		0b00000000000000000000000011111000,
		0b11000110011011010000000000100001,
		0b00001111010001100011000111110000,
		0b00000000000000000011101000110000,
		0b10000011110000000000000010000101,
		0b11110001100011000101111000000000,
		0b00000000000011101000111111100000,
		0b11110000000000000110010001110001,
		0b00001000010000100000000000000000,
		0b00000011111000110001100010111100,
		0b00101110100001000011110100011000,
		0b11000110001000000000000100000000,
		0b01000010000100001000010000000000,
		0b00001000000000100001000010000100,
		0b00100001001100010000100001001010,
		0b10011100100101000100000000000010,
		0b00010000100001000010000100001100,
		0b00000000000000000001111010101101,
		0b01101011010100000000000000000000,
		0b10110110011000110001100010000000,
		0b00000000000000111010001100011000,
		0b10111000000000000000000000111101,
		0b00011000110001111101000010000000,
		0b00000000111110001100011000101111,
		0b00001000010000000000101101100110,
		0b00010000100000000000000000000000,
		0b00111110000011100000111110000000,
		0b00000010000100011110010000100001,
		0b00000110000000000000000000010001,
		0b10001100011001101101000000000000,
		0b00000000100011000101010010100010,
		0b00000000000000000000010101101011,
		0b01011010101010000000000000000000,
		0b00100010101000100010101000100000,
		0b00000000000000010001100011000110,
		0b00101111000010111000000000001111,
		0b10001000100010001111100000000000
	};
	
	Font monaco = {
		.glyph = (Glyph) { fontData, (GPoint) { 5, 9 } },
		.scale = 2,
		.spacing = 2,
		.color = GColorVividCerulean
	};
	
	int x = ( 180 - ( ( monaco.glyph.size.x * monaco.scale ) + monaco.spacing ) * 11 ) >> 1;
	const int dy = ( monaco.glyph.size.y * monaco.scale + monaco.spacing );
	
	drawText( "HELLO WORLD", &monaco, frameBuffer, (GPoint) { x, 90 - dy } );
	drawText( "hello world", &monaco, frameBuffer, (GPoint) { x, 90 } );
	drawText( "0123456789", &monaco, frameBuffer, (GPoint) { x, 90 + dy } );
	
	// Finally, release the framebuffer
	graphics_release_frame_buffer( context, frameBuffer );
}

static void init() {
	// Create a window and get information about the window
	s_window = window_create();
	Layer *window_layer = window_get_root_layer(s_window);
	
	layer_set_update_proc(window_layer, layer_update_proc);
	
	// Push the window, setting the window animation to 'true'
	window_stack_push(s_window, true);
}

static void deinit() {
	// Destroy the window
	window_destroy(s_window);
}

int main() {
	init();
	app_event_loop();
	deinit();
}
